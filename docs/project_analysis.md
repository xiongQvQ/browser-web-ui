# Browser Web UI 项目分析文档

## 1. 项目概述
这是一个基于AI Agent的自动化浏览器操作项目，能够通过自然语言指令控制浏览器执行各种任务。项目使用了Playwright作为浏览器自动化框架，结合LangChain进行LLM调用，通过Gradio提供Web界面。

## 2. 项目结构

```
browser-web-ui/
├── src/                    # 源代码目录
│   ├── agent/             # AI Agent相关实现
│   ├── browser/           # 浏览器控制相关实现
│   ├── controller/        # 控制器实现
│   ├── prompts/           # 提示词模板
│   └── utils/             # 工具函数
├── tests/                 # 测试目录
├── assets/                # 静态资源
├── webui.py              # Web界面主入口
├── requirements.txt       # 项目依赖
└── .env.example          # 环境变量示例
```

## 3. 核心组件

### 3.1 Agent 系统
- **CustomAgent (src/agent/custom_agent.py)**
  - 继承自基础Agent类
  - 负责任务执行的核心逻辑
  - 管理LLM交互和行为决策
  - 包含任务执行、步骤管理等功能

### 3.2 浏览器控制
- **CustomBrowser (src/browser/custom_browser.py)**
  - 封装了Playwright的浏览器操作
  - 提供浏览器上下文管理
  - 处理页面交互和导航

### 3.3 Web界面
- **webui.py**
  - 使用Gradio构建用户界面
  - 提供任务配置和执行接口
  - 支持录制和回放功能

## 4. AI Agent工作流程

### 4.1 初始化流程
1. 加载环境配置
2. 初始化LLM模型
3. 创建浏览器实例
4. 设置浏览器上下文

### 4.2 任务执行流程
1. **任务接收**
   - 接收用户输入的自然语言任务
   - 解析附加信息和参数

2. **Agent执行循环**
   - 分析当前状态
   - 决策下一步行动
   - 执行行动
   - 记录结果
   - 判断是否完成任务

3. **错误处理**
   - 最大失败次数控制
   - 重试机制
   - 错误日志记录

### 4.3 关键功能
- **视觉理解**：支持网页截图分析
- **上下文管理**：维护对话历史和状态
- **行为验证**：验证执行结果
- **录制回放**：支持操作录制和回放

## 5. 核心配置项

### 5.1 Agent配置
- 任务最大步骤数
- 重试次数和延迟
- 视觉分析开关
- 对话历史保存

### 5.2 浏览器配置
- 窗口大小
- 无头模式
- 安全设置
- 录制路径

### 5.3 LLM配置
- 模型提供商
- 模型名称
- 温度参数
- API密钥

## 6. 扩展性设计

### 6.1 自定义组件
- 支持自定义Agent实现
- 可扩展的浏览器控制器
- 灵活的提示词系统

### 6.2 接口抽象
- 统一的消息接口
- 标准化的行为定义
- 可扩展的事件系统

## 7. 使用建议

### 7.1 最佳实践
- 合理设置最大步骤数
- 适当配置重试参数
- 根据需求启用视觉分析
- 定期清理录制文件

### 7.2 注意事项
- API密钥安全管理
- 资源使用监控
- 错误日志分析
- 性能优化考虑 